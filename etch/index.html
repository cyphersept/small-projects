<!DOCTYPE html>
<html lang= "en">

<head>
    <meta charset="UTF-8"
    <title>Etch-A-Sketch</title>
    <link rel="stylesheet" href="etch-a-sketch-style.css">
</head>

<!-- TODO: Dynamically change tile size so that overall dimensions of canvas remains fixed -->

<body class="sketch" onload="clearPad();">
    <div class="buttons">
        <div class="left">
            <button class="clear">‚ùåClear</button>
            <label for="size">Size:</label>
            <input type="number" id="size" value="16" min="1" max="100" required="true">
        </div>

        <div class="center">
            <div>Etch-A-Sketch</div>
        </div>

        <div class="tools">
            <button class="rainbow">üåà</button>
            <button class="toggled pen">‚úèÔ∏è</button>
            <button class="eraser">üßº</button>
        </div>
    </div>

    <div class="drawpad">
    </div>

<script>
    const root= document.querySelector(".drawpad");
    
    const tools = document.querySelector('.tools');
    const clearBtn = document.querySelector('.clear');
    const penBtn = tools.querySelector('.pen');
    const rainbowBtn = tools.querySelector('.rainbow');
    const eraserBtn = tools.querySelector('.eraser');
        
    let dimension= 16;
    let currentSize= 1;
    let selectedTool= penBtn;    
    let isDrawing = false;
    
    clearBtn.onclick = () => clearPad();
    penBtn.onclick = () => {toggleBtn(penBtn); selectedTool = penBtn};
    rainbowBtn.onclick = () => {toggleBtn(rainbowBtn); selectedTool = rainbowBtn};
    eraserBtn.onclick = () => {toggleBtn(eraserBtn); selectedTool = eraserBtn;};
    document.addEventListener("mousedown", () => {isDrawing = true});
    document.addEventListener("mouseup", () => {isDrawing = false});
    
    function toggleBtn(btn) {
        selectedTool.classList.remove("toggled");
        btn.classList.toggle("toggled");
    }

    function clearPad() {    //Changes pad to new size and resets colours
        updatePad(updateSize());
        document.querySelectorAll(".tile").forEach((e) => {
            e.style.backgroundColor = "rgb(255,255,255)";
        });
    }
    
    function updateSize() {     //Changes targetSize according to input
        let newSize = document.querySelector("#size").value;
        newSize = (newSize > 100) ? 100
            : (newSize < 1) ? 1 
                : newSize
        dimension = parseInt(newSize);
        const newWidth = dimension*10;
        root.style.width = `${newWidth}px`;
        // document.querySelector(".buttons").style.width = `${newWidth}px`;
        return newSize;
    }

    function updatePad(targetSize) {
        const target = targetSize*targetSize;
        let curr = root.childElementCount;
        for (curr; curr < target; curr++) {
            let newTile = document.createElement("div");
            newTile.classList.add('tile');
            newTile.addEventListener('mousemove', () => { //colour tiles with tools
                if (isDrawing == true) changeColour(newTile);
            });
            root.appendChild(newTile); 
        }
        for (curr; curr > target; curr--) {
            root.removeChild(root.lastChild);
    }
}
    
    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1) + min)
    }
    
    function changeColour(e) {
        let colour;
        if (selectedTool == penBtn) {
            colour = "rgb(22, 22, 22)";
        } else if (selectedTool == eraserBtn) {
            colour = "rgb(255, 255, 255)"
        } else {
            const vals = [randomInt(0, 360), randomInt(60, 95), randomInt(60, 90)]
            colour = `hsl(${vals[0]}, ${vals[1]}%, ${vals[2]}%)`
        } 
        e.style.backgroundColor = colour;
    }
    </script>
</body>
</html>